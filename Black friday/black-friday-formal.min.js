!function(o){var t=o(window),n=parseInt(new Date/1e3),s={start:function(){s.init(),s.runTimer(),s.windowScroll(),s.carouselText(),s.initSwitch(),s.addToCart(),s.asyncPrice(),s.initShare(),s.initPopMsg(),s.getCoupon()},init:function(){o(".js-lazyImg").lazyload({effect:"fadeIn"}),o(window).scrollTop(getParamsFromUrl("scrollTop")),s.getDiscount(o(".js-discount")),o(".js-activeImg").lazyload({effect:"fadeIn",failure_limit:2e3,threshold:99999})},getDiscount:function(t){t.each(function(){var t=o(this),n=t.closest(".deal-item"),s=Number(n.find(".goods-price").attr("data-orgp")),e=Number(n.find(".goods-oldprice").attr("data-orgp")),a=0;s<e&&(a=Math.round(100*(e-s)/e),a>=20&&(t.find(".num").html(a),t.css("visibility","visible")))})},runTimer:function(){var t=new Timer("#promotion-countdown",{format:"<span>${d}</span><span>${h}</span><span>${m}</span><span>${s}</span>",charWrap:!0,interval:function(){return this.data("end")-n}});t.add(".js-timer-title",{format:"Begins In: ${d}:${h}:${m}:${s}",interval:function(){return(parseInt(o(this).data("begin"))||0)-n},onEnd:function(){t.add(this,{format:"Ends In: ${d}:${h}:${m}:${s}",interval:function(){return(parseInt(o(this).data("end"))||0)-n}})}}),t.add(".js-timer-goods",{format:"Begins In: ${d}丨${h}丨${m}丨${s}",interval:function(){return parseInt(this.closest(".deal-item").find(".remaining").text())>0?(parseInt(this.data("begin"))||0)-n:0},onStart:function(){var o=this.closest(".deal-item").find(".goods-btn");o.addClass("if-coming").html("COMING SOON")},onEnd:function(){t.add(this,{format:"Ends In: ${d}丨${h}丨${m}丨${s}",interval:function(){return parseInt(this.closest(".deal-item").find(".remaining").text())>0?(parseInt(o(this).data("end"))||0)-n:0},onStart:function(){var o=this.closest(".deal-item").find(".goods-btn");o.removeClass("if-coming").addClass("if-normal").html("BUY NOW")},onEnd:function(){var o=this.closest(".deal-item").find(".goods-btn");o.removeClass("if-normal").addClass("if-ended").html("DEAL ENDED")}})}})},addToCart:function(){o(".js-addToCart").on("click",function(o){GLOBAL.cart.addcart(this,1,o)})},initSwitch:function(){o(".js-switch").each(function(){var t=o(this),n=t.find(".switch-nav-item"),s=t.find(".switch-content-item");t.on("click",".switch-nav-item",function(){var t=o(this),e=null;t.hasClass("on")||(n.removeClass("on"),t.addClass("on"),s.removeClass("on"),e=s.eq(t.index()),e.addClass("on"),e.hasClass("actived")||(e.addClass("actived"),e.find(".js-lazyImg-ctrl").lazyload({effect:"fadeIn"})))}),n.eq(0).trigger("click")})},asyncPrice:function(){window.getAsyncPrice(o(".ajax-price-2"),{callback:function(t,n){t.each(function(t){var e=o(this),a=e.closest(".deal-item"),i=a.find(".goods-oldprice"),r=a.find(".goods-discount");Number(n[t].displayPrice)>0&&e.attr("data-orgp",n[t].displayPrice),i.length>0&&Number(e.attr("data-orgp"))<Number(i.data("orgp"))&&i.removeClass("hide"),r.length>0&&s.getDiscount(r)}),GLOBAL.currency.change_html(null,null,t)}})},carouselText:function(){function t(){n.eq(s).addClass("in"),n.eq(s-1).hasClass("in")&&n.eq(s-1).removeClass("in").addClass("out"),n.eq(s-2).removeClass("out"),s=s<n.length-1?s+1:0}var n=o("#carousel-text .link"),s=0,e=!0;t(),setInterval(function(){e&&t()},3e3),o("#carousel-text").on("mouseenter",function(){e=!1}).on("mouseleave",function(){e=!0})},windowScroll:function(){function n(){r.addClass("show-nav"),a.css("left",t.width()/2-790)}function s(){r.removeClass("show-nav"),a.css("left",0)}function e(){u=i.height(),p=t.height(),h.posStatus=-1,g.posStatus=-1,f=[],setTimeout(function(){c.each(function(){f.push(o(this).offset().top)})},0)}var a=o("#view-screen"),i=o("#promotion-body"),r=o("#promotion-nav"),l=r.find(".nav .item"),c=o(".js-anchor-mod"),d=i.offset().top,u=0,p=0,f=[],m=debounce(e,1e3,!0),h={posStatus:-1,onScroll:function(o){o<d?0!=this.posStatus&&(r.css({position:"absolute",top:d}),this.posStatus=0):o>d+u-854?2!=this.posStatus&&(r.css({position:"absolute",top:d+u-854}),this.posStatus=2):1!=this.posStatus&&(r.css({position:"fixed",top:0}),this.posStatus=1)}},g={posStatus:-1,init:function(){return l.on("click",function(){o("body,html").animate({scrollTop:f[o(this).index()]-60},500),s()}),this},onScroll:function(o){for(var t=0;t<f.length&&!(o<f[t]-p/2);t++);t=t<1?1:t,g.posStatus!=t&&(l.removeClass("on").eq(t-1).addClass("on"),g.posStatus=t)}}.init();t.scroll(function(){var o=t.scrollTop();m(),h.onScroll(o),g.onScroll(o)}),t.on("resize",function(){s(),t.trigger("scroll")}).trigger("resize"),o(function(){e(),t.trigger("scroll")}),o("#go-top").on("click",function(){o("body,html").animate({scrollTop:255},"slow"),s()}),o("#nav-toggle").on("click",function(){r.hasClass("show-nav")||n()}),o(document).on("mousedown",function(t){r.hasClass("show-nav")&&0===o(t.target).closest("#promotion-nav").length&&s()})},initShare:function(){var t=o("#promotion-id").val();shareActivity(".js-share",{url:window.location.href,title:"#Black Friday Doorbuster#",image:"https://uidesign.gbtcdn.com/GB/images/promotion/2017/black_friday/formal/share.jpg",desc:"Doorbuster sale Only last 4 days!Unbelievably Low Price!Up To 80% Off! ",onSuccess:function(n){var s={fb:1,tw:2,vk:3,gg:4,rt:5};o.ajax({url:"/m-promotion-active-"+t+".html",type:"POST",dataType:"json",data:{fack_type:s[n],site_type:1},success:function(o){setTimeout(function(){popMsg("Share Successfully!")},500)}})}})},initPopMsg:function(){var t=o("#pop-dimmer"),n=o("#custom-content");window.popMsg=function(o){n.html(o),t.addClass("pop-in")},o("#pop-close").click(function(){t.removeClass("pop-in")})},getCoupon:function(){o(".js-getCoupon").on("click",function(){var t=o(this),n=t.data("id");if(t.hasClass("doing")||t.hasClass("if-alltaken")||t.hasClass("if-expired"))popMsg("Sorry, no more coupons are available");else if(o.cookie("isLogin")&&o.cookie("isLogin").length>0){if(t.hasClass("if-received"))return void popMsg("You have already claimed yours!");t.addClass("doing"),o.ajax({url:"/m-coupon_center-a-get_coupon",type:"POST",dataType:"json",data:{type:"by_id",req_content:n,platform:"Web"}}).done(function(o){1==o.status?(t.removeClass("if-normal").addClass("if-received").html("Already Received"),popMsg('<p>Coupon Received! Coupon:</p><p class="coupon-tip">'+o.coupon+'</p><p>Please check it in your GB account - <a class="link" href="'+DOMAIN_USER+"/"+JS_LANG+'my-coupon.htm" target="_blank">My Coupon</a>.</p>')):0==o.status&&(10004==o.code?(t.removeClass("if-normal").addClass("if-alltaken").html("All Taken"),popMsg("Sorry, no more coupons are available!")):10003==o.code?(t.removeClass("if-normal").addClass("if-expired").html("Coupon Expired"),popMsg("Sorry, no more coupons are available!")):10012==o.code||10013==o.code?popMsg(o.msg):10006==o.code||10031==o.code?popMsg("Sorry, Coupons are not available now!"):10018==o.code?(t.removeClass("if-normal").addClass("if-received").html("Already Received"),popMsg("You have already claimed yours!")):popMsg(o.msg))}).fail(function(){popMsg("please check your network!")}).always(function(){t.removeClass("doing")})}else window.location.href=HTTPS_LOGIN_DOMAIN+"/"+JS_LANG+"m-users-a-sign.htm?ref="+window.location.href})}};s.start()}(jQuery);