webpackJsonp([11],{1052:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e){return{user:e.user,ticket:e.feedback.ticket}}Object.defineProperty(t,"__esModule",{value:!0});var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),f=n(1),d=a(f),p=n(12),m=n(147),b=n(60),h=n(145),k=a(h),v=n(1080),y=a(v),_=n(1101),g=a(_),E=n(377),O=n(21),T=d.default.createElement(b.Link,{to:"/feedback",className:"btn btn-secondary"},"Назад"),j=function(e){function t(e){o(this,t);var n=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return w.call(n),n.state={loading:!1,initializing:!1},n}return i(t,e),u(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.user,n=e.params.ticketID,a=e.resetTickets;isNaN(n)?this.context.router.push("/feedback"):(t.id&&this._fetchTicket(n),a(),this._setUpdateInterval(n))}},{key:"componentWillReceiveProps",value:function(e){var t=e.user,n=e.params.ticketID;!this.props.ticket&&t.id&&this._fetchTicket(n)}},{key:"componentWillUnmount",value:function(){this.props.resetTicket(),clearInterval(this.ticketUpdateInterval)}},{key:"render",value:function(){var e=this.props,t=e.user,n=e.ticket,a=e.params.ticketID,r=e.handleSubmit,o=this.state,c=o.loading,i=o.initializing;return d.default.createElement("div",{className:"xbox xbox_feedback-ticket"},d.default.createElement("div",{className:"xbox__header"},d.default.createElement("h4",null,n?n.subject:"Обращение #"+a)),d.default.createElement("div",{className:"xbox__body"},d.default.createElement(g.default,{user:t,ticket:n,handleSubmit:r(this._submit),handleScroll:this._handleScroll,loading:c,initializing:i})),d.default.createElement("div",{className:"xbox__footer"},d.default.createElement("div",{className:"btn-toolbar"},T,this._renderTicketActions(n))))}}]),t}(f.Component),w=function(){var e=this;this._setUpdateInterval=function(t){var n=e.props,a=n.fetchTicket,r=n.fetchAlerts;e.ticketUpdateInterval=setInterval(function(){a({ticketID:t}).then(function(){r()})},1e4)},this._submit=function(t){var n=e.props,a=n.addMessage,r=n.fetchTicket,o=n.params.ticketID,c=n.dispatch;return e.setState({loading:!0}),a(s({},t,{ticketID:o})).then(function(t){var n=t.payload;"success"===n.data.status?r({ticketID:o}).then(function(){c((0,m.reset)("TicketForm")),e.setState({loading:!1})}):(e.setState({loading:!1}),(0,O.handleError)(n.data))})},this._handleSuccess=function(t){var n=t.ticketID,a=t.status;e._fetchTicket(n),(0,O.alertSuccess)("Обращение #"+n+" успешно "+(a?"закрыто":"открыто")+".")},this._fetchTicket=function(t){var n=e.props,a=n.fetchTicket,r=n.fetchAlerts;e.setState({initializing:!0}),a({ticketID:t}).then(function(n){var a=n.payload;e.setState({initializing:!1});var o=a.data.status;if(o){var c=a.data.message;"error"===o?"feedbackNotFound"===c?(e.context.router.push("/feedback"),(0,O.handleError)({message:c,data:{ticketID:t}})):(0,O.handleError)(a.data):r()}else(0,O.alertError)("Что-то пошло не так...")})},this._renderTicketActions=function(t){var n=e.props,a=n.closeTicket,o=n.openTicket,c=n.submitting,i=n.handleSubmit,l=n.invalid,s=e.state,u=s.initializing,f=s.loading;if(t){var p=t.ticketID,m=t.status,b=[d.default.createElement(y.default,{key:0,item:t,data:{ticketID:p},body:"Вы уверены что хотите "+(m?"закрыть":"открыть")+" обращение #"+p+"?",actionButton:{className:"btn "+(m?"btn-danger":"btn-secondary"),disabled:c||f||u},confirmButton:{confirmText:m?"Закрыть":"Открыть",className:m?"btn btn-danger":"btn btn-success"},action:m?a:o,successCallback:e._handleSuccess,errorCallback:O.alertError},d.default.createElement("span",null,m?"Закрыть":"Открыть"))];return m&&(b=[].concat(r(b),[d.default.createElement("div",{key:1,className:"ml-auto"},d.default.createElement(k.default,{className:"btn btn-success",loading:c||f,disabled:u||l,onClick:i(e._submit)},"Отправить"))])),b}},this._handleScroll=function(e){var t=e.scrollTop,n=e.scrollHeight;(0===t||n-550<=t)&&(e.scrollTop=n)}};j.contextTypes={router:f.PropTypes.object};var N=function(e){var t=e.message,n={};return t&&t.replace(/\s/g,"")||(n.message="Введите сообщение"),n};j=(0,m.reduxForm)({form:"TicketForm",validate:N})(j),t.default=(0,p.connect)(l,{addMessage:E.addMessage,fetchTicket:E.fetchTicket,resetTicket:E.resetTicket,openTicket:E.openTicket,closeTicket:E.closeTicket,resetTickets:E.resetTickets,fetchAlerts:E.fetchAlerts})(j)},1080:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function r(e,t){var n={};for(var a in e)t.indexOf(a)>=0||Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=e[a]);return n}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),u=n(1),f=a(u),d=n(37),p=n(145),m=a(p),b=function(e){function t(){o(this,t);var e=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._submit=function(){var t=e.props,n=t.action,a=t.successCallback,r=t.errorCallback,o=t.data,c=t.item;e.setState({loading:!0}),n(o).then(function(t){e.setState({loading:!1}),"success"===t.payload.data.status?(e._toggle(),a(c,t.payload.data)):r(t.payload.data.message)})},e._toggle=function(){e.setState({isOpen:!e.state.isOpen})},e.state={isOpen:!1,loading:!1},e}return i(t,e),s(t,[{key:"render",value:function(){var e=this.props,t=e.body,n=e.title,a=e.actionButton,o=e.confirmButton,c=o.confirmText,i=r(o,["confirmText"]),s=e.cancelButton,u=s.cancelText,p=r(s,["cancelText"]),b=e.children,h=this.state,k=h.loading,v=h.isOpen;return f.default.createElement("button",l({},a,{onClick:this._toggle}),b,f.default.createElement(d.Modal,{isOpen:v,backdrop:!k||"static",keyboard:!k,toggle:this._toggle},f.default.createElement("div",{className:"modal-header"},f.default.createElement("h5",{className:"modal-title"},n)),f.default.createElement(d.ModalBody,null,f.default.createElement("div",{className:"text-center"},t)),f.default.createElement(d.ModalFooter,null,f.default.createElement("button",l({},p,{disabled:k,onClick:this._toggle}),u),f.default.createElement("div",{className:"ml-auto"},f.default.createElement(m.default,l({},i,{loading:k,onClick:this._submit}),c)))))}}]),t}(u.Component);b.defaultProps={title:"Подтвердите действие",confirmButton:{className:"btn btn-success",confirmText:"Подтвердить"},cancelButton:{className:"btn btn-secondary",cancelText:"Отмена"},actionButton:{className:"btn btn-danger"},children:f.default.createElement("span",null,"Действие")},t.default=b},1081:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),r=function(e){return e&&e.__esModule?e:{default:e}}(a),o=r.default.createElement("div",{className:"text-center"},"Пожалуйста, авторизуйтесь на сайте."),c=function(){return o};t.default=c},1101:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),l=n(1),s=a(l),u=n(147),f=n(53),d=a(f),p=n(110),m=a(p),b=n(1081),h=a(b),k=n(229),v=n(21),y=s.default.createElement("br",null),_=s.default.createElement(h.default,null),g=s.default.createElement(m.default,null),E=function(e){function t(){var e,n,a,c;r(this,t);for(var i=arguments.length,l=Array(i),u=0;u<i;u++)l[u]=arguments[u];return n=a=o(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),a._renderMessages=function(e){var t=a.props.user;return e.messages.map(function(e){var n=e.messageID,a=e.steamID,r=e.message,o=e.timestamp,c=e.steamData,i=r.split("\n");return i=i.map(function(e){return[e?s.default.createElement("span",null,e):null,y]}),s.default.createElement("div",{key:n,className:"ticket-item"+(t.steamID===a?" ticket-item_user":"")},s.default.createElement("div",{className:"ticket-item__author"},s.default.createElement("a",{href:"//steamcommunity.com/profiles/"+a,target:"_blank",rel:"noopener noreferrer"},(0,v.fromBase64)(c[0]))),s.default.createElement("div",{className:"ticket-item__message"},i),s.default.createElement("div",{className:"ticket-item__date"},(0,d.default)(1e3*o).format("DD.MM.YY HH:mm:ss")))})},c=n,o(a,c)}return c(t,e),i(t,[{key:"componentDidUpdate",value:function(){var e=this.props,t=e.ticket,n=e.handleScroll;t&&n(this.refs.ticketMessages)}},{key:"render",value:function(){var e=this.props,t=e.user,n=e.ticket,a=e.loading,r=e.initializing,o=e.handleSubmit;return t.id?n?s.default.createElement("div",{className:"ticket"},s.default.createElement("div",{ref:"ticketMessages",className:"ticket__messages"},this._renderMessages(n)),n&&n.status?s.default.createElement("div",{className:"ticket__form"},s.default.createElement("form",{onSubmit:o,autoComplete:"off"},s.default.createElement(u.Field,{name:"message",className:"form-control",placeholder:"Введите сообщение",rows:"5",disabled:a||r,component:k.$textAreaField,label:"Сообщение"}))):null):g:_}}]),t}(l.Component);t.default=E}});